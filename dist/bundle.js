(()=>{class t{constructor(){this.overlay=document.createElement("div"),this.overlay.className="ai-suggestion-overlay",this.overlay.style.cssText="\n          position: absolute;\n          pointer-events: none;\n          color: #9CA3AF;\n          font-family: monospace;\n          white-space: pre;\n          z-index: 10000;\n          background: transparent;   \n      ",document.body.appendChild(this.overlay)}show(t,e,s){const n=t.getBoundingClientRect(),i=window.getComputedStyle(t),o=document.createElement("span");o.style.cssText=`\n          position: absolute;\n          visibility: hidden;\n          font-family: ${i.fontFamily};\n          font-size: ${i.fontSize};\n          letter-spacing: ${i.letterSpacing};\n          white-space: pre;\n      `,o.textContent=t.value.substring(0,s),document.body.appendChild(o);const r=o.getBoundingClientRect().width;document.body.removeChild(o),this.overlay.style.top=`${n.top+window.scrollY}px`,this.overlay.style.left=`${n.left+window.scrollX+r}px`,this.overlay.style.height=i.lineHeight,this.overlay.style.padding=i.padding,this.overlay.style.fontSize=i.fontSize,this.overlay.style.fontFamily=i.fontFamily,this.overlay.style.letterSpacing=i.letterSpacing,this.overlay.lineHeight=i.lineHeight,this.overlay.textContent=e,this.overlay.style.display="block"}hide(){this.overlay.style.display="none"}}new class{constructor(){this.currentElement=null,this.suggestion="",this.overlay=new t,this.cursorPosition=0,this.debounceGetSuggestion=(t=>{let e;return function(){for(var s=arguments.length,n=new Array(s),i=0;i<s;i++)n[i]=arguments[i];clearTimeout(e),e=setTimeout((()=>t(...n)),500)}})(this.getSuggestion.bind(this)),this.setupEventListeners()}async getSuggestion(t,e){if(!t.trim())return this.suggestion="",void this.overlay.hide();try{const s=await(async t=>{const e=await fetch("http://localhost:3000/api/gemini",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:t})});if(!e.ok)throw new Error("Failed to get completion");const s=await e.json();try{return"string"==typeof s.response?JSON.parse(s.response):s.response}catch(t){return s.response}})(t);this.suggestion=s.trim(),this.currentElement&&this.suggestion&&this.overlay.show(this.currentElement,this.suggestion,e)}catch(t){console.error("Error getting suggestions:",t),this.suggestion="",this.overlay.hide()}}handleInput(t){const e=t.target;this.currentElement=e,this.cursorPosition=e.selectionStart,this.debounceGetSuggestion(e.value,this.cursorPosition)}handleKeyDown(t){if("Tab"===t.key&&this.suggestion){t.preventDefault();const e=t.target,s=e.value.slice(0,this.cursorPosition),n=e.value.slice(this.cursorPosition);e.value=s+this.suggestion+n;const i=this.cursorPosition+this.suggestion.length;e.setSelectionRange(i,i),this.suggestion="",this.overlay.hide()}}handleSelectionChange(t){this.currentElement!==t.target&&(this.cursorPosition=t.target.selectionStart,this.suggestion&&this.overlay.show(this.currentElement,this.suggestion,this.cursorPosition))}handleFocus(t){this.currentElement=t.target,this.cursorPosition=this.currentElement.selectionStart,t.target.value&&this.suggestion&&this.overlay.show(this.currentElement,this.suggestion,this.cursorPosition)}handleBlur(){this.currentElement=null,this.overlay.hide()}setupEventListeners(){document.addEventListener("input",this.handleInput.bind(this)),document.addEventListener("keydown",this.handleKeyDown.bind(this)),document.addEventListener("focus",this.handleFocus.bind(this),!0),document.addEventListener("blur",this.handleBlur.bind(this),!0),document.addEventListener("selectionchange",this.handleSelectionChange.bind(this),!0)}}})();